#!/usr/bin/env zsh

# Usage: toggleInput <enable|disable> <partial-device-name>
# Example: toggleInput enable ILIATEK-TP

set -euo pipefail

if [[ $# -ne 2 ]]; then
  echo "Usage: $0 <enable|disable> <device-name-part>"
  exit 1
fi

ACTION="$1"
DEVICE_PATTERN="$2"

if [[ "$ACTION" != "enable" && "$ACTION" != "disable" ]]; then
  echo "First argument must be 'enable' or 'disable'"
  exit 1
fi

# Get list of device IDs matching the device pattern
DEVICE_LINE=$(xinput list --name-only | grep -i -- "$DEVICE_PATTERN" | head -n1)

if [[ -z "$DEVICE_LINE" ]]; then
  echo "Device matching '$DEVICE_PATTERN' not found."
  exit 2
fi

# Now, get the device id from `xinput list`
DEVICE_ID=$(xinput list | grep -i -- "$DEVICE_LINE" | sed -n 's/.*id=\([0-9]\+\).*/\1/p')

if [[ -z "$DEVICE_ID" ]]; then
  echo "Could not extract device ID for device '$DEVICE_LINE'"
  exit 3
fi

echo "Attempting to $ACTION device '$DEVICE_LINE' (id=$DEVICE_ID)..."

if xinput "$ACTION" "$DEVICE_ID"; then
  echo "Device '$DEVICE_LINE' ($DEVICE_ID) ${ACTION}d successfully."
  exit 0
else
  echo "Failed to $ACTION device '$DEVICE_LINE' ($DEVICE_ID)."
  exit 4
fi
